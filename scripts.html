<!DOCTYPE html>
<html>
<head>
  <title>Script Tracker</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
  </head>
  <body> {
      background: #f7f8fc;
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    .channel-card {
      background: white;
      margin-bottom: 30px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .channel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .channel-header h2 {
      margin: 0;
      font-size: 22px;
      color: #2a2a2a;
    }
    .progress-bar {
      background: #e3e6ef;
      border-radius: 8px;
      overflow: hidden;
      height: 10px;
      margin-top: 8px;
    }
    .progress-bar-inner {
      height: 100%;
      background: #6c5ce7;
      transition: width 0.3s ease;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    input, select {
      padding: 8px 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
    }
    input:focus, select:focus {
      border-color: #6c5ce7;
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.15);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
      font-size: 15px;
    }
    th {
      color: #444;
      font-weight: 600;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      color: white;
      display: inline-block;
    }
    .Ready { background: #00b894; }
    .Writing { background: #fdcb6e; }
    .Pending { background: #d63031; }
  </style>
</head>
<body>
  
<header>
  <h1>‚úçÔ∏è Script Tracker</h1>
  <p>All channels ‚Ä¢ Ascend-style view</p>
</header>

<nav>
  <a href="index.html">Dashboard</a>
  <a href="calendar.html">üìÖ Calendar</a>
  <a href="scripts.html">Scripts</a>
  <a href="goals.html">Daily Goals</a>
</nav>

<div id="tables"></div>

<!-- ‚úÖ ONLY THIS SCRIPT TAG -->
<script src="js/scripts.js"></script>

const sheetURL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTU4yNw1NlyydNT5CH3XZrGYyS27yZXuK6JKfID416K2nFSwtAznHjlYYySULRP7i8ktOIM54bxl2sn/pub?gid=0&single=true&output=csv";

const channels = [
  "Ender Vij",
  "I'm Gurey",
  "CRUST",
  "Zone-out History",
  "Touristico"
];

// ---------- SAFE CSV PARSER ----------
function parseCSV(text) {
  const lines = text.split("\n").filter(l => l.trim() !== "");
  const rows = [];
  for (let i = 1; i < lines.length; i++) {
    const cols = lines[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
    if (cols) rows.push(cols.map(c => c.replace(/^"|"$/g, "")));
  }
  return rows;
}

// ---------- WEEK RANGE ----------
function getWeekRange(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return null;

  const day = d.getDay() || 7;
  const monday = new Date(d);
  monday.setDate(d.getDate() - day + 1);
  const sunday = new Date(monday);
  sunday.setDate(monday.getDate() + 6);

  return `${monday.toISOString().slice(0,10)} ‚Üí ${sunday
    .toISOString()
    .slice(0,10)}`;
}

// ---------- FETCH & RENDER ----------
fetch(sheetURL)
  .then(res => {
    if (!res.ok) throw new Error("Failed to fetch sheet");
    return res.text();
  })
  .then(text => {
    const rows = parseCSV(text);
    const container = document.getElementById("tables");
    container.innerHTML = "";

    const weeklyGroups = {};
    rows.forEach(r => {
      if (!r[4]) return;
      const week = getWeekRange(r[4]);
      if (!week) return;
      if (!weeklyGroups[week]) weeklyGroups[week] = [];
      weeklyGroups[week].push(r);
    });

    Object.keys(weeklyGroups)
      .sort()
      .reverse()
      .forEach(week => {
        const h2 = document.createElement("h2");
        h2.textContent = `üìÜ Week: ${week}`;
        h2.style.marginTop = "40px";
        container.appendChild(h2);

        channels.forEach(channel => {
          const channelRows = weeklyGroups[week].filter(
            r => r[1] === channel
          );
          if (channelRows.length === 0) return;

          const completed = channelRows.filter(
            r => r[2] === "Ready"
          ).length;
          const percent = Math.round(
            (completed / channelRows.length) * 100
          );

          const card = document.createElement("div");
          card.className = "channel-card";
          card.innerHTML = `
            <div class="channel-header">
              <h3>${channel}</h3>
              <div>${percent}% Ready</div>
            </div>

            <div class="progress-bar">
              <div class="progress-bar-inner" style="width:${percent}%"></div>
            </div>

            <table>
              <tr>
                <th>Title</th>
                <th>Status</th>
                <th>Words</th>
                <th>Date</th>
              </tr>
              ${channelRows
                .map(
                  r => `
                <tr>
                  <td>${r[0]}</td>
                  <td><span class="badge ${r[2]}">${r[2]}</span></td>
                  <td>${r[3]}</td>
                  <td>${r[4]}</td>
                </tr>`
                )
                .join("")}
            </table>
          `;
          container.appendChild(card);
        });
      });
  })
  .catch(err => {
    console.error(err);
    document.getElementById("tables").innerHTML =
      "<p style='color:red'>‚ùå Error loading scripts</p>";
  });

</script>

<script>
function toggleTheme() {
  document.body.classList.toggle("dark");

  localStorage.setItem(
    "theme",
    document.body.classList.contains("dark") ? "dark" : "light"
  );
}

// Apply saved theme on page load
if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark");
}
</script>

</body>
</html>
